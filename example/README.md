# autoftp Automatic Re-run Example

This small example program shows how `autoftp` can be used to accomplish _auto re-running_ of a MicroPython project.  It includes an updated version of [`uftpd.py`](https://github.com/robert-hh/FTP-Server-for-ESP8266-ESP32-and-PYBD) which supports `exec`'ing code via `SITE` commands.  To try it, edit `.autoftp` with your MicroPython host name or IP address, `wifi.py` with your wifi details, and to get started, transfer all the files to the root directory of a clean MicroPython board (using `rshell`, for example).

Once all the files are loaded, soft-reboot (`Ctrl-D`) and you should see the simple startup message.  Now run `autoftp.py` in the same directory.  It will load the `.autoftp` config file.  After it connects to the FTP server, try editing either of the `my*.py` files. They should get uploaded, and the `reload_stop('file')` function is exec'd for the relevant `file`. This function unloads the appropriate modules from `sys.modules`, re-imports the main module (and re-assigns the global variable pointing to it), then stops the current running module.

N.B.: whatever command you execute via `autoftp` _must_ return immediately and not block, or the FTP server will become non-responsive.  In this example, that is accomplished using a main module loop that [monitors for a stop flag](https://github.com/jdtsmith/autoftp/blob/4d8a300fbf42bfd1a96ae10ecea2d28c99454fe3/example/mymod.py#L12) (`self.run`), and a `while True` loop at the end of `main.py`, which restarts the module after it stopped.  

There are many approaches to accomplish this.  The only thing to be sure of is that your `--remote-command` *does not block*.  If you have an unusually deep module import structure, your equivalent of `stop_reload` might need to be more involved, but this example should suffice for many cases.
